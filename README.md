@custom_moviefinder_bot

Лучше поздно чем никогда..

Кинопоиск API поддерживает до 500, а GOOGLE - до 100 запросов в день
В идеале можно было добавить ещё один гугл-апи ключ и переключаться на него, когда исходный закончился, но уже не успеваю это сделать (хотя там просто если json пустой делаем запрос по другому ключу)
Иногда не получается найти корректную ссылку, чтобы найти описание фильма или подходящие ссылки на просмотр, и запрос повторяется
Кинопоиск API позволяет по запросу найти фильм, но я не разобрался, почему у них ничего не работает, и использую его исключительно для получения jsonа из кинопоиск-ссылки на фильм
Бот должен работать быстро, потому что всё асинхронно и парсинг кинопоиска через апи быстрый (а не какие-то там джаваскрипты всякие)
С ссылками проблема, многие могут быть недоступны (но доступны с VPN)
Не хотел останавливаться на rutube/lordfilm/другом сайте, так как на них далеко не всё есть (а у меня крутая обобщающая способность), и например "город в котором меня нет" бы таким образом не нашёлся

Принцип работы:

Делаю запрос по "msg + фильм смотреть онлайн бесплатно", если нахожу при этом и ссылку на кинопоиск, то потрясающе
Если нет, то ищу "msg + фильм кинопоиск" (при pirate = 0) и набираю ссылочки которые показываются как www.kinopoisk.ru
Аккуратненько регуляркой режу 3+ циферки внутри ссылки (это id фильма) причем чтобы не попасться на top250 я проверяю чтобы в ссылке было film/series
Закидываю ID в кинопоиск API, получаю json и из него достаю имя, год, описание, постер
Затем, если был выполнен дополнительный поиск, докидываю результаты к первому и по ним всем ищу пиратские сайты регуляркой "онлайн", выкидывая запрещённые сайты (всякие иви и прочую гадость, которая работает по подписке)
Когда всё нашел иду в database и увеличиваю counter и обновляю время в истории
Историю вывожу корректно, один фильм только один раз, причем храню самое последнее время запроса этого фильма (что логично)

Может выдать ответ по запросу 1+!
Доп фичи не делал, но в целом вроде неплохо получилось, даже самому пользоваться можно

Структура кода: 

Класс Database в отдельном файле с реализацией запросов
Файл links для регулярных выражений и работы со ссылками
Файл api для работы с апишками
В мейне вся работа с ботом (стоило вынести в отдельный файл)
В конфиге все ключи и сообщения для вывода
